<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- Meta Tags Essenciais -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <!-- SEO -->
  <meta name="description" content="Login e cadastro no sistema de agendamentos online">
  <meta name="robots" content="noindex, nofollow">
  
  <!-- T√≠tulo -->
  <title>Login - Sistema de Agendamentos</title>
  
  <!-- Estilos -->
  <link rel="stylesheet" href="assets/style.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîê</text></svg>">
</head>

<body>
  <!-- Container Principal -->
  <main class="container" role="main">
    <!-- Cabe√ßalho -->
    <header>
      <h2>üîê Autentica√ß√£o</h2>
      <p>Entre com sua conta ou crie uma nova</p>
    </header>

    <!-- Formul√°rio de Login -->
    <form id="loginForm" aria-label="Formul√°rio de login" onsubmit="return false;">
      <!-- Campo Email -->
      <div class="form-group">
        <label for="email" class="visually-hidden">E-mail</label>
        <input 
          id="email" 
          type="email" 
          placeholder="Digite seu e-mail" 
          required
          autocomplete="email"
          aria-required="true"
          aria-describedby="emailHelp"
        />
        <small id="emailHelp" style="display: none;">Digite um e-mail v√°lido</small>
      </div>

      <!-- Campo Senha -->
      <div class="form-group">
        <label for="senha" class="visually-hidden">Senha</label>
        <input 
          id="senha" 
          type="password" 
          placeholder="Digite sua senha" 
          required
          autocomplete="current-password"
          minlength="6"
          aria-required="true"
          aria-describedby="senhaHelp"
        />
        <small id="senhaHelp" style="display: none;">A senha deve ter no m√≠nimo 6 caracteres</small>
      </div>

      <!-- Bot√µes de A√ß√£o -->
      <button type="submit" onclick="login()" class="button">
        ‚úÖ Entrar
      </button>
      
      <button type="button" onclick="criarConta()" class="button button-outline">
        ‚ûï Criar Nova Conta
      </button>

      <!-- Link para voltar -->
      <a href="index.html" style="text-align: center; margin-top: 16px;">
        ‚Üê Voltar para p√°gina inicial
      </a>

      <!-- Mensagens de Feedback -->
      <div id="msg" role="alert" aria-live="polite" aria-atomic="true"></div>
    </form>
  </main>

  <!-- Firebase SDK (vers√£o 9 - compatibilidade) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <!-- Configura√ß√£o Firebase -->
  <script src="firebase/firebase-config.js"></script>

  <!-- L√≥gica de Autentica√ß√£o -->
  <script>
    // Elementos do DOM
    const emailInput = document.getElementById('email');
    const senhaInput = document.getElementById('senha');
    const msgElement = document.getElementById('msg');

    // Fun√ß√£o de Login
    function login() {
      // Valida√ß√£o b√°sica
      if (!emailInput.value || !senhaInput.value) {
        mostrarMensagem('Por favor, preencha todos os campos', 'error');
        return;
      }

      // Desabilitar bot√µes durante processamento
      desabilitarFormulario(true);
      mostrarMensagem('Processando login...', 'info');

      // Autenticar com Firebase
      firebase.auth().signInWithEmailAndPassword(emailInput.value, senhaInput.value)
        .then((userCredential) => {
          mostrarMensagem('‚úÖ Login realizado com sucesso! Redirecionando...', 'success');
          setTimeout(() => {
            window.location.href = "agendar.html";
          }, 1500);
        })
        .catch((error) => {
          desabilitarFormulario(false);
          tratarErro(error);
        });
    }

    // Fun√ß√£o de Criar Conta
    function criarConta() {
      // Valida√ß√£o b√°sica
      if (!emailInput.value || !senhaInput.value) {
        mostrarMensagem('Por favor, preencha todos os campos', 'error');
        return;
      }

      // Validar senha
      if (senhaInput.value.length < 6) {
        mostrarMensagem('A senha deve ter no m√≠nimo 6 caracteres', 'error');
        return;
      }

      // Desabilitar bot√µes durante processamento
      desabilitarFormulario(true);
      mostrarMensagem('Criando conta...', 'info');

      // Criar conta com Firebase
      firebase.auth().createUserWithEmailAndPassword(emailInput.value, senhaInput.value)
        .then((userCredential) => {
          mostrarMensagem('‚úÖ Conta criada com sucesso! Agora voc√™ pode fazer login.', 'success');
          senhaInput.value = ''; // Limpar senha
          desabilitarFormulario(false);
        })
        .catch((error) => {
          desabilitarFormulario(false);
          tratarErro(error);
        });
    }

    // Fun√ß√£o para mostrar mensagens
    function mostrarMensagem(mensagem, tipo) {
      msgElement.textContent = mensagem;
      msgElement.className = tipo === 'error' ? 'msg-error' : tipo === 'success' ? 'msg-success' : 'msg-info';
      msgElement.style.display = 'block';
    }

    // Fun√ß√£o para tratar erros do Firebase
    function tratarErro(error) {
      console.error('Erro:', error);
      
      let mensagem = '';
      switch (error.code) {
        case 'auth/invalid-email':
          mensagem = '‚ùå E-mail inv√°lido';
          break;
        case 'auth/user-disabled':
          mensagem = '‚ùå Usu√°rio desabilitado';
          break;
        case 'auth/user-not-found':
          mensagem = '‚ùå Usu√°rio n√£o encontrado';
          break;
        case 'auth/wrong-password':
          mensagem = '‚ùå Senha incorreta';
          break;
        case 'auth/email-already-in-use':
          mensagem = '‚ùå Este e-mail j√° est√° em uso';
          break;
        case 'auth/weak-password':
          mensagem = '‚ùå Senha muito fraca. Use no m√≠nimo 6 caracteres';
          break;
        case 'auth/network-request-failed':
          mensagem = '‚ùå Erro de conex√£o. Verifique sua internet';
          break;
        default:
          mensagem = `‚ùå Erro: ${error.message}`;
      }
      
      mostrarMensagem(mensagem, 'error');
    }

    // Fun√ß√£o para desabilitar/habilitar formul√°rio
    function desabilitarFormulario(desabilitar) {
      const buttons = document.querySelectorAll('button');
      buttons.forEach(btn => btn.disabled = desabilitar);
      emailInput.disabled = desabilitar;
      senhaInput.disabled = desabilitar;
    }

    // Verificar se j√° est√° autenticado
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        console.log('‚úÖ Usu√°rio j√° autenticado:', user.email);
        mostrarMensagem('Voc√™ j√° est√° autenticado. Redirecionando...', 'info');
        setTimeout(() => {
          window.location.href = "agendar.html";
        }, 2000);
      }
    });

    // Enter para submit
    senhaInput.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        login();
      }
    });
  </script>

  <!-- Estilos adicionais para acessibilidade -->
  <style>
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      margin: -1px;
      padding: 0;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    small {
      font-size: 12px;
      color: #6c757d;
      margin-top: 4px;
      display: block;
    }
  </style>
</body>
</html>
